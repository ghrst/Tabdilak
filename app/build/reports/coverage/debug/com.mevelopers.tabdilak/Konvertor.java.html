<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Konvertor.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debug</a> &gt; <a href="index.source.html" class="el_package">com.mevelopers.tabdilak</a> &gt; <span class="el_source">Konvertor.java</span></div><h1>Konvertor.java</h1><pre class="source lang-java linenums">package com.mevelopers.tabdilak;

import java.util.Locale;

import com.mevelopers.tabdilak.R;

import android.annotation.TargetApi;
import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.graphics.Typeface;
import android.os.Build;
import android.os.Bundle;
import android.text.Editable;
import android.text.InputFilter;
import android.text.InputFilter.LengthFilter;
import android.text.TextWatcher;
import android.util.Log;
import android.view.KeyEvent;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.inputmethod.EditorInfo;
import android.view.inputmethod.InputMethodManager;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ImageButton;
import android.widget.RadioButton;
import android.widget.TextView;

<span class="nc" id="L31">public class Konvertor extends Activity {</span>
	public static final String TV_RESULT_KEY = &quot;TC_RESULT_KEY&quot;;
	public static final String TE_NUMBER_KEY = &quot;TE_NUMBER_KEY&quot;;
	
	EditText mTeNumber;
	TextView mTvResult;
	ImageButton mBtnConvert;
    TextView mTvAboutUs;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
<span class="nc" id="L42">		super.onCreate(savedInstanceState);</span>
		//We do not want to see the title-bar!
		//this.requestWindowFeature(Window.FEATURE_NO_TITLE);
<span class="nc" id="L45">		setContentView(R.layout.activity_konvertor);</span>
<span class="nc" id="L46">		mTeNumber = (EditText) findViewById(R.id.TeNumber);</span>
		//Setting max length and decimal filter
<span class="nc" id="L48">		MyLengthFilter lf = new MyLengthFilter(15);</span>
<span class="nc" id="L49">		DecimalInputFilter df = new DecimalInputFilter();</span>
<span class="nc" id="L50">		InputFilter [] f = new InputFilter[2];</span>
<span class="nc" id="L51">		f[0] = lf;</span>
<span class="nc" id="L52">		f[1] = df;</span>
<span class="nc" id="L53">		mTeNumber.setFilters(f);</span>

		//Adding a text watcher for separating numbers by comma
<span class="nc" id="L56">		SeparateNumbersWithComma separator = new SeparateNumbersWithComma();</span>
<span class="nc" id="L57">		mTeNumber.addTextChangedListener(separator);</span>
        //This code here is for handling times when user presses done button on soft-keyboard
<span class="nc" id="L59">        mTeNumber.setOnEditorActionListener(new TextView.OnEditorActionListener() {</span>
                @Override
                public boolean onEditorAction(TextView textView, int i, KeyEvent keyEvent) {
<span class="nc bnc" id="L62" title="All 2 branches missed.">                    if (i == EditorInfo.IME_ACTION_DONE) {</span>
<span class="nc" id="L63">                        mBtnConvert.performClick();</span>
                        //For hiding soft keyboard after entering text!
<span class="nc" id="L65">                        InputMethodManager inputManager = (InputMethodManager) getApplicationContext().getSystemService(Context.INPUT_METHOD_SERVICE);</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">                        if(inputManager != null)</span>
<span class="nc" id="L67">                            inputManager.hideSoftInputFromWindow(mTeNumber.getWindowToken(), InputMethodManager.HIDE_NOT_ALWAYS);</span>
<span class="nc" id="L68">                        return true;</span>
                    }
<span class="nc" id="L70">                    return false;</span>
                }
            });



<span class="nc" id="L76">        mTvResult = (TextView) findViewById(R.id.TvResult);</span>
<span class="nc" id="L77">		mBtnConvert = (ImageButton) findViewById(R.id.BtnConvert);</span>

		//FIXME:: Maybe it is better to use a TextWatcher in order to convert instead of a Button.
<span class="nc" id="L80">		mBtnConvert.setOnClickListener(new View.OnClickListener() {</span>
			
			@Override
			public void onClick(View v) {
<span class="nc" id="L84">				String result = &quot;&quot;;</span>
				/* Notice that all leading zeros will be suppressed by Long.parseLong so we will not have any
				 * problem with automatic radix conversion of Octal to Decimal. For more information refer to test cases! 
				 */
<span class="nc" id="L88">				String userInput = mTeNumber.getText().toString().trim();</span>
<span class="nc bnc" id="L89" title="All 4 branches missed.">				if(userInput.length() == 0 || userInput == null) {</span>
<span class="nc" id="L90">					result = &quot;ظ„ط·ظپط§ ط¹ط¯ط¯ ظ…ظˆط±ط¯ ظ†ط¸ط± ط±ط§ ظˆط§ط±ط¯ ع©ظ†غŒط¯.&quot;;</span>
<span class="nc" id="L91">					mTvResult.setText(result);</span>
<span class="nc" id="L92">					return;</span>
				}
				long convertedUserInput;
				try{
<span class="nc" id="L96">					userInput = userInput.replace(&quot;,&quot;, &quot;&quot;);</span>
<span class="nc" id="L97">					convertedUserInput = Long.parseLong(userInput);</span>
<span class="nc" id="L98">				} catch (Exception e) {</span>
<span class="nc" id="L99">					result = &quot;ظˆط±ظˆط¯غŒ  ظ‚ط§ط¨ظ„ ظ¾ط°غŒط±ط´ ظ†غŒط³طھ. ظپظ‚ط· ط§ط¹ط¯ط§ط¯ طµط­غŒط­ 12 ط±ظ‚ظ…غŒ ظ‚ط§ط¨ظ„ طھط¨ط¯غŒظ„ ظ‡ط³طھظ†ط¯.&quot;;</span>
<span class="nc" id="L100">					mTvResult.setText(result);</span>
<span class="nc" id="L101">					return;</span>
<span class="nc" id="L102">				}</span>
				
				try {
<span class="nc" id="L105">					result = PersianNumeralToWords.numberToString(convertedUserInput);</span>
<span class="nc" id="L106">				} catch (Exception e) {</span>
<span class="nc" id="L107">					result = &quot;ظپظ‚ط· ط§ط¹ط¯ط§ط¯ طµط­غŒط­ ط¨ط§ ط­ط¯ط§ع©ط«ط± 12 ط±ظ‚ظ… ظ‚ط§ط¨ظ„ طھط¨ط¯غŒظ„ ظ‡ط³طھظ†ط¯.&quot;;</span>
<span class="nc" id="L108">					mTvResult.setText(result);</span>
<span class="nc" id="L109">					return;</span>
<span class="nc" id="L110">				}</span>

                //TODO:: Hide the keyboard when user presses this button!

<span class="nc" id="L114">				mTvResult.setText(result);</span>
                //Hiding soft keyboard
<span class="nc" id="L116">                InputMethodManager inputManager = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">                if (inputManager != null) {</span>
<span class="nc" id="L118">                    View temp = getCurrentFocus();</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">                    if (temp != null)</span>
<span class="nc" id="L120">                        inputManager.hideSoftInputFromWindow(temp.getWindowToken(), InputMethodManager.HIDE_NOT_ALWAYS);</span>
                }
				
<span class="nc" id="L123">			}</span>
		});
<span class="nc" id="L125">	}</span>
	

	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
<span class="nc" id="L130">		getMenuInflater().inflate(R.menu.konvertor, menu);</span>
<span class="nc" id="L131">		return true;</span>
	}


	@Override
	public boolean onMenuItemSelected(int featureId, MenuItem item) {
<span class="nc bnc" id="L137" title="All 2 branches missed.">		switch(item.getItemId()) {</span>
		case R.id.menu_about:
<span class="nc" id="L139">            Intent i = new Intent(getApplicationContext(), About.class);</span>
<span class="nc" id="L140">            startActivity(i);</span>
		}
<span class="nc" id="L142">		return true;</span>
	}


	@Override
	protected void onSaveInstanceState(Bundle outState) {
<span class="nc" id="L148">		super.onSaveInstanceState(outState);</span>
<span class="nc" id="L149">		outState.putString(TV_RESULT_KEY, mTvResult.getText().toString());</span>
<span class="nc" id="L150">		outState.putString(TE_NUMBER_KEY, mTeNumber.getText().toString());</span>
<span class="nc" id="L151">	}</span>


	@Override
	protected void onRestoreInstanceState(Bundle savedInstanceState) {
<span class="nc" id="L156">		super.onRestoreInstanceState(savedInstanceState);</span>
<span class="nc" id="L157">		mTvResult.setText(savedInstanceState.getString(TV_RESULT_KEY));</span>
<span class="nc" id="L158">		mTeNumber.setText(savedInstanceState.getString(TE_NUMBER_KEY));</span>
<span class="nc" id="L159">	}</span>
	
	
	// A length filter that has getMax and can be used inside test cases!
	public class MyLengthFilter extends LengthFilter {
		private int maxLength;
<span class="nc" id="L165">		public MyLengthFilter(int max) {</span>
<span class="nc" id="L166">			super(max);</span>
<span class="nc" id="L167">			maxLength = max;</span>
<span class="nc" id="L168">		}</span>
		
		public int getMax() {
<span class="nc" id="L171">			return maxLength;</span>
		}
		
	}
	
	//TextWatcher implementation for separating numbers with a comma
<span class="nc" id="L177">	class SeparateNumbersWithComma implements TextWatcher {</span>
		@Override
		public void onTextChanged(CharSequence s, int start, int before, int count) {
			
<span class="nc" id="L181">		}</span>
		
		@Override
		public void beforeTextChanged(CharSequence s, int start, int count,
				int after) {
<span class="nc" id="L186">		}</span>
		
		@Override
		public void afterTextChanged(Editable s) {
			//Removing the listener temporarily to avoid infinite calls to this function
<span class="nc" id="L191">			mTeNumber.removeTextChangedListener(this);</span>
<span class="nc" id="L192">			String currentValue = mTeNumber.getText().toString();</span>
<span class="nc" id="L193">			String commaSeparatedValue = null;</span>
			try {
				/* May be when we read the text it already has commas in it
				 * In this case a NumberFormatException will occur so we must prevent it
				 * by removing comma.
				 */
<span class="nc bnc" id="L199" title="All 2 branches missed.">				if(currentValue.contains(&quot;,&quot;)) {</span>
<span class="nc" id="L200">					currentValue = currentValue.replace(&quot;,&quot;, &quot;&quot;);</span>
				}
				
<span class="nc bnc" id="L203" title="All 2 branches missed.">				if(currentValue.length() &gt; 0)</span>
<span class="nc" id="L204">					commaSeparatedValue = String.format(Locale.US,&quot;%,d&quot;, Long.parseLong(currentValue));</span>
<span class="nc" id="L205">			} catch(NumberFormatException e) {</span>
<span class="nc" id="L206">				mTvResult.setText(&quot;ظ„ط·ظپط§ ظپظ‚ط· ط§ط² ظ…ظ‚ط§ط¯غŒط± ط¹ط¯ط¯غŒ ط§ط³طھظپط§ط¯ظ‡ ع©ظ†غŒط¯&quot;);</span>
<span class="nc" id="L207">			}</span>
<span class="nc" id="L208">			mTeNumber.setText(null);</span>
<span class="nc" id="L209">			mTeNumber.setText(commaSeparatedValue);</span>
			/*
			 * After changing the text cursor position will be at the beginning of it; if current length of
			 * text if greater than zero we must put the cursor at then end of our text.
			 */
<span class="nc bnc" id="L214" title="All 2 branches missed.">			if(mTeNumber.getText().length() &gt; 0) {</span>
<span class="nc" id="L215">				mTeNumber.setSelection(mTeNumber.getText().length());</span>
			}
<span class="nc" id="L217">			mTeNumber.addTextChangedListener(this);</span>
<span class="nc" id="L218">		}</span>
	}
}



</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>